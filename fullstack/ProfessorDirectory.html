<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Professors</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <link rel="stylesheet" href="../static/styles/main.css">
</head>
<body>
  <div class="topnav">
    <a href="/">Home</a>
    <a href="/page/campuses">Campuses</a>
    <a href="/page/degree">Degrees</a>
    <a href="/page/department">Departments</a>
    <a class="active" href="/page/professor">Staff Directory</a>
    <a href="/course_search">Course Search</a>
    <a href="/page/schedule">Schedule Builder</a>
    <a href="/page/login">Login</a>
  </div>
  <div id="root">Loadingâ€¦</div>

  {%- raw %}
  <script type="text/babel">
    function App() {
      const [professors, setProfessors] = React.useState([]);
      const [departments, setDepartments] = React.useState([]);
      const [selectedDepartment, setSelectedDepartment] = React.useState('');

      React.useEffect(() => {
        fetch("/api/departments")
          .then(r => r.json())
          .then(setDepartments)
          .catch(console.error);
      }, []);

      React.useEffect(() => {
        if (selectedDepartment) {
          fetch(`/api/professors?departmentID=${selectedDepartment}`)
            .then(r => r.json())
            .then(setProfessors)
            .catch(console.error);
        } else {
          setProfessors([]); // Clear professors if no department is selected
        }
      }, [selectedDepartment]);

      const handleDepartmentChange = (event) => {
        setSelectedDepartment(event.target.value);
      };

      return (
        <div>
          <h1>Professors</h1>
          <label htmlFor="departmentFilter">Select Department:</label>
          <select id="departmentFilter" onChange={handleDepartmentChange} value={selectedDepartment}>
            <option value="">All Departments</option>
            {departments.map(department => (
              <option key={department.departmentID} value={department.departmentID}>
                {department.department_name}
              </option>
            ))}
          </select>

          {professors.length > 0 && (
            <table>
              <thead>
                <tr>
                  <th>Professor ID</th>
                  <th>Name</th>
                  <th>Email</th>
                </tr>
              </thead>
              <tbody>
                {professors.map(professor => (
                  <tr key={professor.professorID}>
                    <td>{professor.professorID}</td>
                    <td>{professor.prof_name}</td>
                    <td>{professor.prof_email}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
  {%- endraw %}
</body>
</html>